<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>MARS FUTURE AI</title>

<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  background:#000;
  font-family:system-ui,sans-serif;
}
canvas{display:block;touch-action:none}

/* START SCREEN */
#startScreen{
  position:fixed;inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at center,#3a0a0a 0%,#000 70%);
  z-index:10;
}
#title{
  position:absolute;top:50px;
  text-align:center;
  color:#7a0000;
  font-size:56px;
  letter-spacing:4px;
  text-shadow:0 0 20px #400;
}
#gameStart{
  font-family:monospace;
  font-size:26px;
  padding:18px 42px;
  color:#fff;
  border:3px solid #fff;
  cursor:pointer;
  margin-bottom:18px;
}
#gameStart:hover{animation:blink .15s infinite}
@keyframes blink{50%{opacity:.3}}

#bgmBtn{
  font-size:14px;
  color:#ccc;
  cursor:pointer;
  opacity:.7;
}
#bgmBtn:hover{opacity:1}
</style>
</head>

<body>

<div id="startScreen">
  <div id="title">MARS<br>FUTURE<br>AI</div>
  <div id="gameStart">GAME START</div>
  <div id="bgmBtn">BGM : OFF</div>
</div>

<canvas id="c"></canvas>

<script>
/* ================= BASIC ================= */
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

/* ================= AUDIO ================= */
const bgm=new Audio("화성.mp3");
bgm.loop=true;
bgm.volume=0.6;
let bgmEnabled=false;

/* ================= START PAGE ================= */
let gameRunning=false;
const startScreen=document.getElementById("startScreen");
document.getElementById("gameStart").onclick=()=>{
  startScreen.style.display="none";
  gameRunning=true;
  if(bgmEnabled){
    bgm.play().catch(()=>{});
  }
};
const bgmBtn=document.getElementById("bgmBtn");
bgmBtn.onclick=()=>{
  bgmEnabled=!bgmEnabled;
  bgmBtn.innerText=bgmEnabled?"BGM : ON":"BGM : OFF";
  if(!gameRunning)return;
  bgmEnabled?bgm.play().catch(()=>{}):bgm.pause();
};

/* ================= STATE ================= */
let score=0,nextBossScore=10000;
let boss=null;
const player={
  x:c.width/2,y:c.height*0.8,r:14,
  hp:100,
  shield:0,shieldTimer:0,
  power:1,powerTimer:0
};
let bullets=[],enemies=[],enemyBullets=[],items=[];
let flashTimer=0;

/* ================= INPUT ================= */
let usingTouch=false;
c.addEventListener("mousemove",e=>{
  if(usingTouch)return;
  player.x=e.clientX;player.y=e.clientY;
});
c.addEventListener("touchstart",e=>{
  usingTouch=true;
  const t=e.touches[0];
  player.x=t.clientX;player.y=t.clientY;
});
c.addEventListener("touchmove",e=>{
  usingTouch=true;
  const t=e.touches[0];
  player.x=t.clientX;player.y=t.clientY;
  e.preventDefault();
},{passive:false});
c.addEventListener("touchend",()=>usingTouch=false);

/* ================= FIRE ================= */
setInterval(()=>{
  if(!gameRunning)return;
  for(let i=0;i<player.power;i++){
    bullets.push({
      x:player.x+(i-(player.power-1)/2)*10,
      y:player.y,v:10,dmg:20
    });
  }
},200);

/* ================= ENEMY ================= */
setInterval(()=>{
  if(!gameRunning)return;
  const r=Math.random();
  let type=r<0.33?"chaser":r<0.66?"zigzag":"fast";
  enemies.push({
    x:Math.random()*c.width,y:-30,
    size:14,type,hp:40,
    speed:type==="fast"?4+Math.random()*2:type==="chaser"?2.5:2,
    angle:0
  });
},900);

/* ================= ITEM ================= */
setInterval(()=>{
  if(!gameRunning)return;
  const r=Math.random();
  let type=r<0.33?"power":r<0.66?"shield":"bomb";
  items.push({x:Math.random()*c.width,y:-20,r:10,type,v:2});
},5000);

/* ================= BOSS ================= */
function spawnBoss(){
  boss={x:c.width/2,y:120,r:50,maxHp:5000,hp:5000,phase:1,cd:0};
}
function updateBoss(){
  if(!boss)return;
  const level=Math.floor(score/10000);
  if(boss.hp<=boss.maxHp*0.5)boss.phase=2;
  boss.x+=Math.sin(Date.now()*0.004)*(boss.phase===2?4:2);
  boss.cd--;
  const rate=Math.max(20,80-level*10);
  if(boss.cd<=0){
    const cnt=6+level*2+(boss.phase===2?4:0);
    for(let i=0;i<cnt;i++){
      const a=i*(Math.PI*2/cnt);
      enemyBullets.push({x:boss.x,y:boss.y,vx:Math.cos(a)*3,vy:Math.sin(a)*3});
    }
    boss.cd=rate;
  }
}

/* ================= LOOP ================= */
function loop(){
  ctx.clearRect(0,0,c.width,c.height);
  if(!gameRunning){requestAnimationFrame(loop);return;}

  if(score>=nextBossScore&&!boss){spawnBoss();nextBossScore+=10000;}

  if(player.powerTimer>0&&--player.powerTimer<=0)player.power=1;
  if(player.shieldTimer>0&&--player.shieldTimer<=0)player.shield=0;
  if(flashTimer>0)flashTimer--;

  bullets=bullets.filter(b=>{b.y-=b.v;return b.y>0});

  enemies=enemies.filter(e=>{
    if(e.type==="fast")e.y+=e.speed;
    if(e.type==="chaser"){
      const dx=player.x-e.x,dy=player.y-e.y,l=Math.hypot(dx,dy);
      e.x+=dx/l*e.speed;e.y+=dy/l*e.speed;
    }
    if(e.type==="zigzag"){e.y+=e.speed;e.x+=Math.sin(e.angle+=0.1)*3;}

    if(Math.hypot(e.x-player.x,e.y-player.y)<player.r+e.size){
      player.hp-=10;return false;
    }
    bullets.forEach((b,i)=>{
      if(Math.hypot(b.x-e.x,b.y-e.y)<e.size){
        e.hp-=b.dmg;bullets.splice(i,1);
      }
    });
    if(e.hp<=0){score+=100;return false;}
    return e.y<c.height+40;
  });

  updateBoss();
  if(boss){
    bullets.forEach((b,i)=>{
      if(Math.hypot(b.x-boss.x,b.y-boss.y)<boss.r){
        boss.hp-=b.dmg;bullets.splice(i,1);
      }
    });
    if(boss.hp<=0){boss=null;enemyBullets=[];score+=3000;}
  }

  enemyBullets=enemyBullets.filter(b=>{
    b.x+=b.vx;b.y+=b.vy;
    if(Math.hypot(b.x-player.x,b.y-player.y)<player.r){
      player.shield>0?player.shield-=10:player.hp-=10;
      return false;
    }
    return b.x>0&&b.x<c.width&&b.y>0&&b.y<c.height;
  });

  items=items.filter(it=>{
    it.y+=it.v;
    if(Math.hypot(it.x-player.x,it.y-player.y)<player.r){
      if(it.type==="power"){player.power=Math.min(3,player.power+1);player.powerTimer=1800;}
      if(it.type==="shield"){player.shield=player.hp;player.shieldTimer=1800;}
      if(it.type==="bomb"){flashTimer=15;enemies=[];enemyBullets=[];if(boss)boss.hp-=1000;}
      return false;
    }
    return it.y<c.height;
  });

  if(flashTimer>0){
    ctx.fillStyle="rgba(255,255,255,0.2)";
    ctx.fillRect(0,0,c.width,c.height);
  }

  ctx.fillStyle="#0af";
  ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,Math.PI*2);ctx.fill();

  if(player.shield>0){
    ctx.strokeStyle="#0f0";
    ctx.beginPath();ctx.arc(player.x,player.y,player.r+5,0,Math.PI*2);ctx.stroke();
  }

  ctx.fillStyle="#fff";
  bullets.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,3,0,Math.PI*2);ctx.fill()});

  ctx.fillStyle="#f44";
  enemies.forEach(e=>{
    ctx.beginPath();
    ctx.moveTo(e.x,e.y-e.size);
    ctx.lineTo(e.x-e.size,e.y+e.size);
    ctx.lineTo(e.x+e.size,e.y+e.size);
    ctx.closePath();ctx.fill();
  });

  ctx.fillStyle="#fa0";
  enemyBullets.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,4,0,Math.PI*2);ctx.fill()});

  items.forEach(it=>{
    ctx.fillStyle=it.type==="power"?"#4af":it.type==="shield"?"#4f4":"#f44";
    ctx.beginPath();ctx.arc(it.x,it.y,it.r,0,Math.PI*2);ctx.fill();
  });

  if(boss){
    ctx.fillStyle="#f0f";
    ctx.beginPath();ctx.arc(boss.x,boss.y,boss.r,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#400";ctx.fillRect(20,20,c.width-40,10);
    ctx.fillStyle="#f00";
    ctx.fillRect(20,20,(c.width-40)*(boss.hp/boss.maxHp),10);
  }

  ctx.fillStyle="#fff";
  ctx.fillText("SCORE: "+score,20,c.height-20);
  ctx.fillText("HP: "+player.hp,c.width-100,c.height-20);

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
