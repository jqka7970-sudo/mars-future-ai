<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>MARS FUTURE AI - BOSS BATTLE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --mars: #ff3333; --ui-gold: #ffcc00; --boss-hp: #ff0044; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        
        .bg-overlay {
            position: absolute; width: 100%; height: 100%;
            background: linear-gradient(to bottom, #1a0505 0%, #3d0e0e 50%, #1a0505 100%);
            opacity: 0.8; z-index: 0;
        }

        #ui-layer { 
            position: relative; z-index: 10; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; height: 100vh; 
        }
        
        h1 { 
            font-size: 5rem; color: var(--mars); text-align: center; 
            letter-spacing: 10px; margin-bottom: 40px;
            filter: drop-shadow(0 0 10px rgba(255,0,0,0.5));
        }

        #start-btn {
            padding: 15px 40px; font-size: 1.5rem; background: transparent; 
            color: white; border: 3px solid var(--mars); cursor: pointer;
            font-family: 'Orbitron'; transition: 0.2s;
        }
        #start-btn:hover {
            background: var(--mars); color: black;
            animation: arcade-blink 0.2s infinite;
        }

        @keyframes arcade-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }

        #sound-ctrl { margin-top: 25px; background: none; border: 1px solid #444; color: #888; cursor: pointer; }

        canvas { display: none; background: #0a0000; margin: 0 auto; cursor: none; border: 2px solid #331111; }
        
        #hud { 
            position: absolute; top: 10px; width: 100%; display: none;
            justify-content: space-around; color: var(--ui-gold); font-size: 1.2rem; z-index: 20;
        }
        #boss-ui {
            position: absolute; top: 50px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 10px; border: 1px solid white; display: none;
        }
        #boss-hp-bar { width: 100%; height: 100%; background: var(--boss-hp); transition: 0.1s; }
    </style>
</head>
<body>

<div class="bg-overlay"></div>

<div id="hud">
    <span>SCORE: <span id="score">0</span></span>
    <span>LIVES: <span id="lives">3</span></span>
</div>

<div id="boss-ui"><div id="boss-hp-bar"></div></div>

<div id="ui-layer">
    <h1>MARS<br>FUTURE AI</h1>
    <button id="start-btn">START GAME</button>
    <button id="sound-ctrl">üéµ SOUND: OFF</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const uiLayer = document.getElementById('ui-layer');
    const hud = document.getElementById('hud');
    const bossUi = document.getElementById('boss-ui');
    const bossHpBar = document.getElementById('boss-hp-bar');

    let gameActive = false;
    let score = 0;
    let lives = 3;
    let frame = 0;
    let powerLevel = 1; // 1: Í∏∞Î≥∏, 3: ÏÑ∏ Í∞àÎûò
    let powerTimer = 0;

    const player = { x: 0, y: 0 };
    let bullets = [];
    let enemies = [];
    let enemyBullets = [];
    let items = [];
    let explosions = [];

    // Î≥¥Ïä§ Îç∞Ïù¥ÌÑ∞
    let boss = { active: false, x: 240, y: -100, hp: 100, maxHp: 100, dir: 1 };

    document.getElementById('start-btn').onclick = () => {
        uiLayer.style.display = 'none';
        hud.style.display = 'flex';
        canvas.style.display = 'block';
        canvas.width = 480;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2;
        player.y = canvas.height - 80;
        gameActive = true;
        update();
    };

    window.onmousemove = (e) => {
        if(!gameActive) return;
        const rect = canvas.getBoundingClientRect();
        player.x = e.clientX - rect.left;
        player.y = e.clientY - rect.top;
    };

    function createExplosion(x, y, color = 'rgba(255, 100, 0,') {
        for(let i=0; i<10; i++) {
            explosions.push({ x, y, vx: (Math.random()-0.5)*12, vy: (Math.random()-0.5)*12, life: 25, color });
        }
    }

    function update() {
        if (!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        frame++;

        // 1. ÌîåÎ†àÏù¥Ïñ¥ & ÌååÏõåÏóÖ ÏÉÅÌÉú Í¥ÄÎ¶¨
        if(powerTimer > 0) {
            powerTimer--;
            if(powerTimer <= 0) powerLevel = 1;
        }
        ctx.fillStyle = powerLevel > 1 ? '#00ffff' : '#ffffff';
        ctx.beginPath();
        ctx.moveTo(player.x, player.y - 20); ctx.lineTo(player.x - 20, player.y + 20); ctx.lineTo(player.x + 20, player.y + 20);
        ctx.fill();
        ctx.fillStyle = 'red'; ctx.fillRect(player.x-2, player.y-2, 4, 4); // ÌîºÍ≤©Ï†ê

        // 2. Í≥µÍ≤© (ÌååÏõåÏóÖ Ïãú 3Í∞àÎûò)
        if (frame % 7 === 0) {
            bullets.push({x: player.x, y: player.y - 20, vx: 0, vy: -15});
            if(powerLevel >= 3) {
                bullets.push({x: player.x, y: player.y - 20, vx: -3, vy: -14});
                bullets.push({x: player.x, y: player.y - 20, vx: 3, vy: -14});
            }
        }
        bullets.forEach((b, i) => {
            b.x += b.vx; b.y += b.vy;
            ctx.fillStyle = powerLevel > 1 ? '#0ff' : '#ff0';
            ctx.fillRect(b.x-2, b.y, 4, 15);
            if(b.y < 0) bullets.splice(i, 1);
        });

        // 3. ÏïÑÏù¥ÌÖú Î°úÏßÅ
        items.forEach((it, i) => {
            it.y += 2;
            ctx.fillStyle = '#ffcc00';
            ctx.font = 'bold 20px Orbitron';
            ctx.fillText('P', it.x, it.y);
            if(Math.hypot(it.x - player.x, it.y - player.y) < 30) {
                powerLevel = 3; powerTimer = 600; // 10Ï¥à Ïú†ÏßÄ
                items.splice(i, 1);
            }
        });

        // 4. Î≥¥Ïä§Ï†Ñ Ïó¨Î∂Ä ÌôïÏù∏ (2000Ï†ê Ïù¥ÏÉÅ)
        if (score >= 2000 && !boss.active) {
            boss.active = true;
            bossUi.style.display = 'block';
        }

        if (boss.active) {
            // Î≥¥Ïä§ Ïù¥Îèô Î∞è Ìå®ÌÑ¥
            if (boss.y < 150) boss.y += 1;
            boss.x += 2 * boss.dir;
            if (boss.x > canvas.width - 60 || boss.x < 60) boss.dir *= -1;

            ctx.fillStyle = '#550000';
            ctx.fillRect(boss.x - 60, boss.y - 40, 120, 80); // Î≥¥Ïä§ Î≥∏Ï≤¥
            ctx.fillStyle = '#ff3333';
            ctx.fillRect(boss.x - 20, boss.y + 20, 40, 20); // Î≥¥Ïä§ Ìè¨Ìä∏

            if (frame % 40 === 0) {
                for(let j=-2; j<=2; j++) {
                    enemyBullets.push({x: boss.x + j*20, y: boss.y + 40, vx: j*1.5, vy: 5});
                }
            }

            // Î≥¥Ïä§ ÌîºÍ≤©
            bullets.forEach((pb, pi) => {
                if (Math.abs(pb.x - boss.x) < 60 && Math.abs(pb.y - boss.y) < 40) {
                    boss.hp -= 0.5;
                    bullets.splice(pi, 1);
                    bossHpBar.style.width = (boss.hp / boss.maxHp * 100) + '%';
                    if (boss.hp <= 0) {
                        createExplosion(boss.x, boss.y, 'rgba(255,255,255,');
                        score += 5000;
                        boss.active = false;
                        bossUi.style.display = 'none';
                        alert("MARS THREAT ELIMINATED!\nFINAL SCORE: " + score);
                        location.reload();
                    }
                }
            });
        } else {
            // ÏùºÎ∞ò Ï†Å Ïä§Ìè∞
            if (frame % 50 === 0) {
                enemies.push({ x: Math.random() * (canvas.width - 40) + 20, y: -50, hp: 2 });
            }
        }

        // 5. ÏùºÎ∞ò Ï†Å & ÌÉÑÎßâ
        enemies.forEach((en, i) => {
            en.y += 3;
            ctx.fillStyle = '#ff4444';
            ctx.fillRect(en.x-15, en.y-15, 30, 30);

            bullets.forEach((pb, pi) => {
                if (Math.abs(pb.x - en.x) < 20 && Math.abs(pb.y - en.y) < 20) {
                    en.hp--; bullets.splice(pi, 1);
                    if (en.hp <= 0) {
                        if(Math.random() > 0.8) items.push({x: en.x, y: en.y});
                        createExplosion(en.x, en.y);
                        enemies.splice(i, 1);
                        score += 100;
                        document.getElementById('score').innerText = score;
                    }
                }
            });
            if (en.y > canvas.height) enemies.splice(i, 1);
        });

        enemyBullets.forEach((eb, i) => {
            eb.x += eb.vx || 0; eb.y += eb.vy;
            ctx.fillStyle = '#ff00ff';
            ctx.beginPath(); ctx.arc(eb.x, eb.y, 6, 0, Math.PI*2); ctx.fill();

            if (Math.abs(eb.x - player.x) < 8 && Math.abs(eb.y - player.y) < 8) {
                enemyBullets.splice(i, 1);
                lives--;
                document.getElementById('lives').innerText = lives;
                if (lives <= 0) {
                    gameActive = false;
                    alert("GAME OVER\nSCORE: " + score);
                    location.reload();
                }
            }
            if (eb.y > canvas.height) enemyBullets.splice(i, 1);
        });

        explosions.forEach((ex, i) => {
            ex.x += ex.vx; ex.y += ex.vy; ex.life--;
            ctx.fillStyle = `${ex.color}${ex.life/25})`;
            ctx.fillRect(ex.x, ex.y, 3, 3);
            if(ex.life <= 0) explosions.splice(i, 1);
        });

        requestAnimationFrame(update);
    }
</script>
</body>
</html>
