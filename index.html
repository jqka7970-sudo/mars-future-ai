<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>MARS FUTURE AI</title>

<style>
html,body{
  margin:0; width:100%; height:100%;
  overflow:hidden; background:#000;
}
canvas{display:block}

/* ===== MENU ===== */
#menu{
  position:fixed; inset:0;
  background:#000;
  z-index:10;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}
#title{
  position:absolute; top:60px;
  text-align:center;
  font-family:Orbitron,sans-serif;
  color:#6b0000;
  font-size:64px;
  text-shadow:0 0 20px #300;
}
#startBtn{
  font-family:'Press Start 2P', monospace;
  font-size:24px;
  color:#fff;
  border:3px solid #fff;
  padding:20px 40px;
  cursor:pointer;
}
#startBtn:hover{ animation: blink .15s infinite; }
@keyframes blink{
  0%,100%{opacity:1}
  50%{opacity:.3}
}
#bgmBtn{
  position:absolute;
  right:20px; bottom:20px;
  color:#aaa;
  font-family:monospace;
  cursor:pointer;
}

/* ===== HUD ===== */
#hud{
  position:fixed; top:10px; left:10px;
  font-family:monospace;
  font-size:13px;
  color:#0ff;
  background:rgba(0,0,0,.5);
  padding:8px;
  border-radius:4px;
}
#psycheHud,#aiHud{
  font-size:11px;
  opacity:.6;
}

/* ===== WARNING ===== */
#warning{
  position:fixed; inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  font-size:64px;
  color:#f00;
  background:rgba(0,0,0,.7);
  z-index:20;
  animation: blink .2s infinite;
}

/* ===== REPORT ===== */
#report{
  position:fixed; inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.85);
  z-index:30;
}
#reportBox{
  color:#fff;
  font-family:monospace;
  max-width:500px;
  line-height:1.8;
}
</style>
</head>

<body>

<div id="menu">
  <div id="title">
    <div>MARS</div>
    <div>FUTURE</div>
    <div>AI</div>
  </div>
  <div id="startBtn">GAME START</div>
  <div id="bgmBtn">BGM : OFF</div>
</div>

<div id="hud">
  SCORE <span id="score">0</span><br>
  HP <span id="hp">100</span><br>
  <div id="psycheHud">STATE : ---</div>
  <div id="aiHud">AI ADAPT : 0%</div>
</div>

<div id="warning">WARNING</div>

<div id="report">
  <div id="reportBox"></div>
</div>

<canvas id="c"></canvas>

<script>
/* ================= BASIC ================= */
const c = document.getElementById('c');
const ctx = c.getContext('2d');
function resize(){ c.width=innerWidth; c.height=innerHeight; }
resize(); addEventListener('resize',resize);

/* ================= ASSETS ================= */
const IMG = {};
[
 'bg_mars1','bg_mars2','player',
 'enemy_straight','enemy_zigzag','enemy_sniper',
 'boss1','boss2','boss3',
 'item_bullets','item_shield','item_bomb'
].forEach(k=>{
  IMG[k]=new Image();
  IMG[k].src='assets/'+k+'.png';
});

/* ================= MENU ================= */
let gameActive=false;
document.getElementById('startBtn').onclick=()=>{
  document.getElementById('menu').style.display='none';
  gameActive=true;
};

/* ================= GAME STATE ================= */
let score=0, hp=100;
let bullets=[], enemies=[], bossBullets=[], items=[];
let boss=null, inBossIntro=false, introTimer=0;

const player={
  x:c.width/2, y:c.height-120,
  power:1, bulletTimer:0,
  shield:0, shieldTimer:0
};

/* ================= PSYCHE ================= */
const psyche={ move:0, shoot:0, near:0 };
function analyzePsyche(){
  if(psyche.shoot > psyche.move*2) return 'AGGRESSIVE';
  if(psyche.move > psyche.shoot*2) return 'PANIC';
  if(psyche.near < 3) return 'TUNNEL';
  return 'BALANCED';
}

/* ================= AI ADAPT ================= */
let aiAdapt=0;
let currentState='BALANCED';
let stateTimer=0;

/* ================= INPUT ================= */
addEventListener('mousemove',e=>{
  player.x=e.clientX; player.y=e.clientY;
  psyche.move++;
});

/* ================= BACKGROUND ================= */
let bgY=0, bgIdx=0;
const BG=['bg_mars1','bg_mars2'];
function drawBG(){
  bgY+=1.5;
  if(bgY>c.height){ bgY=0; bgIdx=(bgIdx+1)%2; }
  ctx.drawImage(IMG[BG[bgIdx]],0,bgY-c.height,c.width,c.height);
  ctx.drawImage(IMG[BG[(bgIdx+1)%2]],0,bgY,c.width,c.height);
}

/* ================= SPAWN ================= */
function spawnEnemy(){
  const r=Math.random();
  let t='enemy_straight';
  if(r>0.7) t='enemy_zigzag';
  if(r>0.9) t='enemy_sniper';
  enemies.push({x:Math.random()*c.width,y:-50,type:t,tick:0});
}
function tryDrop(x,y){
  if(Math.random()>0.02) return;
  const r=Math.random();
  let t='item_bullets';
  if(r>0.9) t='item_bomb';
  else if(r>0.45) t='item_shield';
  items.push({x,y,type:t});
}

/* ================= BOSS ================= */
function startBossIntro(){
  inBossIntro=true;
  introTimer=3000;
  document.getElementById('warning').style.display='flex';
}
function spawnBoss(){
  boss={
    x:c.width/2,y:120,
    hp:800+aiAdapt*5,
    img:IMG['boss'+(1+Math.floor(Math.random()*3))],
    atk:0
  };
}
function bossAttack(d){
  boss.atk+=d;
  const rate=Math.max(200,900-aiAdapt*6);
  if(boss.atk<rate) return;
  boss.atk=0;

  if(currentState==='AGGRESSIVE'){
    for(let a=-2;a<=2;a++)
      bossBullets.push({x:boss.x,y:boss.y,vx:a*2,vy:4});
  }
  else if(currentState==='PANIC'){
    const dx=player.x-boss.x,dy=player.y-boss.y;
    const l=Math.hypot(dx,dy);
    for(let i=-1;i<=1;i++)
      bossBullets.push({x:boss.x,y:boss.y,
        vx:(dx/l)*4+i*1.5,vy:(dy/l)*4});
  }
  else if(currentState==='TUNNEL'){
    bossBullets.push({x:0,y:boss.y,vx:4,vy:0});
    bossBullets.push({x:c.width,y:boss.y,vx:-4,vy:0});
  }
  else{
    for(let a=-1;a<=1;a++)
      bossBullets.push({x:boss.x,y:boss.y,vx:a*1.5,vy:4});
  }
}

/* ================= DEATH REPORT ================= */
function showReport(){
  const s=analyzePsyche();
  document.getElementById('reportBox').innerHTML=`
    <h2>AI ANALYSIS</h2>
    <p>Final Score : ${score}</p>
    <p>Playstyle : ${s}</p>
    <p>The AI adapted to your behavior.</p>
    <p>Press F5 to retry.</p>`;
  document.getElementById('report').style.display='flex';
}

/* ================= LOOP ================= */
let last=0;
function loop(t){
  requestAnimationFrame(loop);
  if(!gameActive) return;
  const d=t-last; last=t;

  ctx.clearRect(0,0,c.width,c.height);
  drawBG();

  aiAdapt=Math.min(100,aiAdapt+d*0.002);
  stateTimer+=d;
  if(stateTimer>1500){
    stateTimer=0;
    currentState=analyzePsyche();
    document.getElementById('psycheHud').innerText='STATE : '+currentState;
  }
  document.getElementById('aiHud').innerText='AI ADAPT : '+Math.floor(aiAdapt)+'%';

  if(!boss && !inBossIntro && score>2000) startBossIntro();
  if(inBossIntro){
    introTimer-=d;
    if(introTimer<=0){
      inBossIntro=false;
      document.getElementById('warning').style.display='none';
      spawnBoss();
    }
    return;
  }

  if(!boss && Math.random()<0.03) spawnEnemy();

  /* bullets */
  if(Math.random()<0.15){
    for(let i=0;i<player.power;i++)
      bullets.push({x:player.x+(i-(player.power-1)/2)*12,y:player.y});
    psyche.shoot++;
  }
  bullets=bullets.filter(b=>{
    b.y-=12;
    ctx.fillStyle='#0ff';
    ctx.fillRect(b.x-2,b.y-10,4,10);
    return b.y>-20;
  });

  /* enemies */
  enemies=enemies.filter(e=>{
    e.tick++;
    if(e.type==='enemy_straight') e.y+=3;
    if(e.type==='enemy_zigzag'){ e.y+=2; e.x+=Math.sin(e.tick*0.1)*4; }
    if(e.type==='enemy_sniper') e.y+=4;
    ctx.drawImage(IMG[e.type],e.x-24,e.y-24,48,48);

    for(let i=bullets.length-1;i>=0;i--){
      if(Math.hypot(bullets[i].x-e.x,bullets[i].y-e.y)<26){
        bullets.splice(i,1);
        score+=100;
        tryDrop(e.x,e.y);
        return false;
      }
    }
    return e.y<c.height+60;
  });

  /* boss */
  if(boss){
    ctx.drawImage(boss.img,boss.x-96,boss.y-64,192,128);
    bossAttack(d);
  }

  bossBullets=bossBullets.filter(b=>{
    b.x+=b.vx; b.y+=b.vy;
    ctx.fillStyle='red';
    ctx.fillRect(b.x-3,b.y-3,6,6);
    if(Math.hypot(player.x-b.x,player.y-b.y)<20){
      hp-=20;
      if(hp<=0){ showReport(); gameActive=false; }
      return false;
    }
    return b.x>-20&&b.x<c.width+20&&b.y>-20&&b.y<c.height+20;
  });

  /* player */
  ctx.drawImage(IMG.player,player.x-32,player.y-32,64,64);

  document.getElementById('score').innerText=score;
  document.getElementById('hp').innerText=hp;
}
requestAnimationFrame(loop);
</script>
</body>
</html>
