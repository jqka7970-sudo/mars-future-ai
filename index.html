<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Mars Future AI</title>

<style>
html,body{
margin:0;width:100%;height:100%;overflow:hidden;
background:#1a0505;color:white;font-family:Orbitron,sans-serif;
}
#bg{position:fixed;inset:0;height:200%;background:
linear-gradient(rgba(0,0,0,.3),rgba(0,0,0,.3)),
url('https://images.unsplash.com/photo-1614728894747-a83421e2b9c9?auto=format&fit=crop&q=80&w=2000');
background-size:cover;z-index:-1;}
#hud{position:fixed;top:10px;left:10px;color:#ff4d4d}
#chapterTitle{
position:fixed;inset:0;display:flex;
align-items:center;justify-content:center;
font-size:48px;color:#ff4d4d;
background:rgba(0,0,0,.7);z-index:10;
}
canvas{position:fixed;inset:0}
</style>
</head>

<body>

<div id="bg"></div>
<div id="hud">
CHAPTER <span id="ch">1</span> |
SCORE <span id="score">0</span> |
HP <span id="hp">100</span>
</div>
<div id="chapterTitle" style="display:none"></div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const title=document.getElementById('chapterTitle');

let player={x:innerWidth/2,y:innerHeight/2};
let bullets=[], enemies=[], boss=null;
let score=0, hp=100;
let last=0, shootCD=0;
let chapter=1, phase='combat';
let chapterTimer=0;

function resize(){
canvas.width=innerWidth; canvas.height=innerHeight;
}
resize(); addEventListener('resize',resize);

addEventListener('mousemove',e=>{
player.x=e.clientX; player.y=e.clientY;
});
addEventListener('touchmove',e=>{
player.x=e.touches[0].clientX;
player.y=e.touches[0].clientY;
},{passive:false});

const ENEMY={
straight:e=>{e.y+=e.s},
zigzag:e=>{e.y+=e.s; e.x+=Math.sin(e.y*0.05)*3},
sniper:e=>{
e.y+=e.s;
if(!e.lock&&e.y>120){e.tx=player.x;e.lock=true}
if(e.lock)e.x+=(e.tx-e.x)*0.03;
}
};

function showChapter(text){
title.innerText=text;
title.style.display='flex';
setTimeout(()=>title.style.display='none',1500);
}

function spawnEnemy(){
const types=['straight','zigzag','sniper'];
const t=types[Math.min(types.length-1,chapter-1)];
enemies.push({
x:Math.random()*canvas.width,
y:-40,type:t,s:2+chapter
});
}

function spawnBoss(){
boss={x:canvas.width/2,y:-120,hp:300+chapter*300,t:0};
phase='boss';
}

function updateBoss(){
boss.t++;
if(boss.y<100) boss.y+=2;
boss.x+=Math.sin(boss.t*0.03)*4;

if(boss.t%60===0){
enemies.push({x:boss.x,y:boss.y+40,type:'straight',s:4+chapter});
}

ctx.fillStyle='#f33';
ctx.fillRect(boss.x-60,boss.y-40,120,80);
ctx.fillStyle='#0f0';
ctx.fillRect(boss.x-60,boss.y-55,(boss.hp/(300+chapter*300))*120,8);

for(let i=bullets.length-1;i>=0;i--){
if(Math.hypot(bullets[i].x-boss.x,bullets[i].y-boss.y)<70){
bullets.splice(i,1); boss.hp-=10;
if(boss.hp<=0){
boss=null;
chapter++;
if(chapter>3){alert('MISSION COMPLETE'); location.reload();}
document.getElementById('ch').innerText=chapter;
showChapter('CHAPTER '+chapter);
phase='combat';
}
}
}
}

function loop(t){
const d=t-last; last=t;
ctx.clearRect(0,0,canvas.width,canvas.height);

/* background scroll */
document.getElementById('bg').style.backgroundPosition=`0 ${t*0.05}px`;

/* shooting */
shootCD-=d;
if(shootCD<=0){
bullets.push({x:player.x,y:player.y});
shootCD=150;
}
bullets=bullets.filter(b=>{
b.y-=14;
ctx.fillStyle='#0ff';
ctx.fillRect(b.x-2,b.y,4,16);
return b.y>-20;
});

/* enemies */
if(phase==='combat'){
chapterTimer+=d;
if(Math.random()<0.02+chapter*0.01) spawnEnemy();
if(chapterTimer>8000){
spawnBoss();
chapterTimer=0;
}
}

enemies=enemies.filter(e=>{
ENEMY[e.type](e);
ctx.fillStyle='#fff';
ctx.fillRect(e.x-15,e.y-15,30,30);

for(let i=bullets.length-1;i>=0;i--){
if(Math.hypot(bullets[i].x-e.x,bullets[i].y-e.y)<25){
bullets.splice(i,1);
score+=100;
document.getElementById('score').innerText=score;
return false;
}
}
if(Math.hypot(player.x-e.x,player.y-e.y)<30){
hp-=20;
document.getElementById('hp').innerText=hp;
if(hp<=0){alert('GAME OVER'); location.reload();}
return false;
}
return e.y<canvas.height+30;
});

/* boss */
if(phase==='boss' && boss) updateBoss();

ctx.fillStyle='#fff';
ctx.fillRect(player.x-20,player.y-20,40,40);

requestAnimationFrame(loop);
}

showChapter('CHAPTER 1');
requestAnimationFrame(loop);
</script>
</body>
</html>
